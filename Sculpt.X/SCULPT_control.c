#include "config_1_2_3.h" // Modified to allow 9600 baudrate
// threading library
//#define use_uart_serial
#include "pt_cornell_1_2_3.h"
#include "gpio.h"
#ifndef _SUPPRESS_PLIB_WARNING
#define _SUPPRESS_PLIB_WARNING
#endif
//////////////////////////////////////
// graphics libraries
#include "tft_master.h"
#include "tft_gfx.h"
// need for rand function
#include <stdlib.h>
// string buffer
char buffer[60];
////////////////////////////////////

////////////////////////////////////

/*Pinout for the PIC for reference*/
//RA0   -   Enable stepper 1
//RA1   -   UART2 TX // stepper 1 DIR
//RA2   -   Y axis Limit Switch
//RA3   -   X axis Limit Switch
//RA4   -   Z axis Limit Switch
//RB0   -   DIR pin for stepper 1 (x-axis) // tft
//RB1   -   STP pin for stepper 1 (x-axis) //tft
//RB2   -   Button to Confirm Material Load //tft
//RB3   -   Red Debug LED // material button
//RB4   -   DIR pin for stepper 2 (y-axis)
//RB5   -   STP pin for stepper 2 (y-axis)
//RB6   -   Not on package
//RB7   -   DIR pin for stepper 3 (z-axis)
//RB8   -   STP pin for stepper 3 (z-axis)
//RB9   -   Enable stepper 3
//RB10  -   UART2 RX // stepper 1 STP
//RB11  -   DC Motor Enable // tft
//RB12  -   Not on Package
//RB13  -   Enable stepper 2
//RB14  -   Green Debug LED // tft
//RB15  -   // dc motor enable

/*********************** [ Constants ] ****************************************/
// Image Size, max seems to be around 175 x 175
#define MAX_IMAGE_SIZE 100*100
#define STEP_X 180
//585
#define STEP_Y 267
//8
#define STEP_Z 9
#define SLEEP_TIME 2

// Stepping Frequency of X & Y, every 1 msec
#define XY_PERIOD  24000
// Stepping Frequency of X & Y, every 6 msec
#define Z_PERIOD 300000

#define X_LIMIT 7030
#define Y_LIMIT 21000
#define Z_LIMIT 8000
#define X_START 350
#define Y_START 4500
#define Z_START 2500
int debug1 = 1; 
int debug2 = 1;
int debug3 = 1;
int debug4 = 0;

/**************** [ Global Variables ] ****************************************/
static struct pt pt_serial, // thread to import data via UART
                 pt_move,   // thread to get positions and move steppers 
                 pt_align;  // thread to align via limit switches
// The following threads are necessary for UART control
static struct pt pt_input, pt_output, pt_DMA_output;
static struct pt pt_tft;

// Data array holding pixelated info of image
typedef unsigned char uint8_t;
typedef struct {
  uint8_t x;
  uint8_t y;
  uint8_t z;
} image_t;
int image_size = 38*45;
image_t image[MAX_IMAGE_SIZE] = 

{
{0, 0, 0}, 
{0, 1, 0}, 
{0, 2, 0}, 
{0, 3, 0}, 
{0, 4, 0}, 
{0, 5, 0}, 
{0, 6, 0}, 
{0, 7, 0}, 
{0, 8, 0}, 
{0, 9, 0}, 
{ 0, 10,  0}, 
{ 0, 11,  0}, 
{ 0, 12,  0}, 
{ 0, 13,  0}, 
{ 0, 14,  0}, 
{ 0, 15,  0}, 
{ 0, 16,  0}, 
{ 0, 17,  0}, 
{ 0, 18,  0}, 
{ 0, 19,  0}, 
{ 0, 20,  0}, 
{ 0, 21,  0}, 
{ 0, 22,  0}, 
{ 0, 23,  0}, 
{ 0, 24,  0}, 
{ 0, 25,  0}, 
{ 0, 26,  0}, 
{ 0, 27,  0}, 
{ 0, 28,  0}, 
{ 0, 29,  0}, 
{ 0, 30,  0}, 
{ 0, 31,  0}, 
{ 0, 32,  0}, 
{ 0, 33,  0}, 
{ 0, 34,  0}, 
{ 0, 35,  0}, 
{ 0, 36,  0}, 
{ 0, 37,  0}, 
{ 0, 38,  0}, 
{ 0, 39,  0}, 
{ 0, 40,  0}, 
{ 0, 41,  0}, 
{ 0, 42,  0}, 
{ 0, 43,  0}, 
{ 0, 44,  0}, 
{1, 0, 0}, 
{1, 1, 0}, 
{1, 2, 0}, 
{1, 3, 0}, 
{1, 4, 0}, 
{1, 5, 0}, 
{1, 6, 0}, 
{1, 7, 0}, 
{1, 8, 0}, 
{1, 9, 0}, 
{ 1, 10,  0}, 
{ 1, 11,  0}, 
{ 1, 12,  0}, 
{ 1, 13,  0}, 
{ 1, 14,  0}, 
{ 1, 15,  0}, 
{ 1, 16,  0}, 
{ 1, 17,  0}, 
{ 1, 18,  0}, 
{ 1, 19,  0}, 
{ 1, 20,  0}, 
{ 1, 21,  0}, 
{ 1, 22,  0}, 
{ 1, 23,  0}, 
{ 1, 24,  0}, 
{ 1, 25,  0}, 
{ 1, 26,  0}, 
{ 1, 27,  0}, 
{ 1, 28,  0}, 
{ 1, 29,  0}, 
{ 1, 30,  0}, 
{ 1, 31,  0}, 
{ 1, 32,  0}, 
{ 1, 33,  0}, 
{ 1, 34,  0}, 
{ 1, 35,  0}, 
{ 1, 36,  0}, 
{ 1, 37,  0}, 
{ 1, 38,  0}, 
{ 1, 39,  1}, 
{ 1, 40,  0}, 
{ 1, 41, 23}, 
{ 1, 42, 52}, 
{ 1, 43, 11}, 
{ 1, 44,  0}, 
{2, 0, 0}, 
{2, 1, 0}, 
{2, 2, 0}, 
{2, 3, 0}, 
{2, 4, 0}, 
{2, 5, 0}, 
{2, 6, 0}, 
{2, 7, 0}, 
{2, 8, 0}, 
{2, 9, 0}, 
{ 2, 10,  0}, 
{ 2, 11,  0}, 
{ 2, 12,  0}, 
{ 2, 13,  0}, 
{ 2, 14,  0}, 
{ 2, 15,  0}, 
{ 2, 16,  0}, 
{ 2, 17,  0}, 
{ 2, 18,  0}, 
{ 2, 19,  0}, 
{ 2, 20,  0}, 
{ 2, 21,  0}, 
{ 2, 22,  0}, 
{ 2, 23,  0}, 
{ 2, 24,  0}, 
{ 2, 25,  0}, 
{ 2, 26,  0}, 
{ 2, 27,  0}, 
{ 2, 28,  0}, 
{ 2, 29,  0}, 
{ 2, 30,  0}, 
{ 2, 31,  0}, 
{ 2, 32,  0}, 
{ 2, 33,  0}, 
{ 2, 34,  0}, 
{ 2, 35,  0}, 
{ 2, 36,  0}, 
{ 2, 37,  0}, 
{ 2, 38,  0}, 
{ 2, 39,  0}, 
{ 2, 40,  9}, 
{ 2, 41, 79}, 
{  2,  42, 102}, 
{ 2, 43, 55}, 
{ 2, 44,  0}, 
{3, 0, 0}, 
{3, 1, 0}, 
{3, 2, 0}, 
{3, 3, 0}, 
{3, 4, 0}, 
{3, 5, 0}, 
{3, 6, 0}, 
{3, 7, 0}, 
{3, 8, 0}, 
{3, 9, 0}, 
{ 3, 10,  0}, 
{ 3, 11,  0}, 
{ 3, 12,  0}, 
{ 3, 13,  0}, 
{ 3, 14,  0}, 
{ 3, 15,  0}, 
{ 3, 16,  0}, 
{ 3, 17,  0}, 
{ 3, 18,  0}, 
{ 3, 19,  0}, 
{ 3, 20,  0}, 
{ 3, 21,  0}, 
{ 3, 22,  0}, 
{ 3, 23,  0}, 
{ 3, 24,  0}, 
{ 3, 25,  0}, 
{ 3, 26,  0}, 
{ 3, 27,  0}, 
{ 3, 28,  0}, 
{ 3, 29,  0}, 
{ 3, 30,  0}, 
{ 3, 31,  0}, 
{ 3, 32,  0}, 
{ 3, 33,  0}, 
{ 3, 34,  0}, 
{ 3, 35,  0}, 
{ 3, 36,  0}, 
{ 3, 37,  0}, 
{ 3, 38,  1}, 
{ 3, 39,  0}, 
{ 3, 40, 56}, 
{  3,  41, 105}, 
{ 3, 42, 98}, 
{ 3, 43, 42}, 
{ 3, 44,  0}, 
{4, 0, 0}, 
{4, 1, 0}, 
{4, 2, 0}, 
{4, 3, 0}, 
{4, 4, 0}, 
{4, 5, 0}, 
{4, 6, 0}, 
{4, 7, 0}, 
{4, 8, 0}, 
{4, 9, 0}, 
{ 4, 10,  0}, 
{ 4, 11,  0}, 
{ 4, 12,  0}, 
{ 4, 13,  0}, 
{ 4, 14,  0}, 
{ 4, 15,  0}, 
{ 4, 16,  0}, 
{ 4, 17,  0}, 
{ 4, 18,  0}, 
{ 4, 19,  0}, 
{ 4, 20,  0}, 
{ 4, 21,  0}, 
{ 4, 22,  0}, 
{ 4, 23,  0}, 
{ 4, 24,  0}, 
{ 4, 25,  0}, 
{ 4, 26,  0}, 
{ 4, 27,  0}, 
{ 4, 28,  0}, 
{ 4, 29,  0}, 
{ 4, 30,  0}, 
{ 4, 31,  0}, 
{ 4, 32,  0}, 
{ 4, 33,  0}, 
{ 4, 34,  0}, 
{ 4, 35,  0}, 
{ 4, 36,  0}, 
{ 4, 37,  0}, 
{ 4, 38,  0}, 
{ 4, 39,  6}, 
{  4,  40, 106}, 
{  4,  41, 118}, 
{ 4, 42, 84}, 
{ 4, 43,  3}, 
{ 4, 44,  0}, 
{5, 0, 0}, 
{5, 1, 0}, 
{5, 2, 0}, 
{5, 3, 0}, 
{5, 4, 0}, 
{5, 5, 0}, 
{5, 6, 0}, 
{5, 7, 0}, 
{5, 8, 0}, 
{5, 9, 0}, 
{ 5, 10,  0}, 
{ 5, 11,  0}, 
{ 5, 12,  0}, 
{ 5, 13,  0}, 
{ 5, 14,  0}, 
{ 5, 15,  0}, 
{ 5, 16,  0}, 
{ 5, 17,  0}, 
{ 5, 18,  0}, 
{ 5, 19,  0}, 
{ 5, 20,  0}, 
{ 5, 21,  0}, 
{ 5, 22,  0}, 
{ 5, 23,  0}, 
{ 5, 24,  0}, 
{ 5, 25,  0}, 
{ 5, 26,  0}, 
{ 5, 27,  0}, 
{ 5, 28,  0}, 
{ 5, 29,  0}, 
{ 5, 30,  0}, 
{ 5, 31,  0}, 
{ 5, 32,  0}, 
{ 5, 33,  0}, 
{ 5, 34,  0}, 
{ 5, 35,  0}, 
{ 5, 36,  0}, 
{ 5, 37,  2}, 
{ 5, 38,  0}, 
{ 5, 39, 32}, 
{  5,  40, 141}, 
{  5,  41, 141}, 
{ 5, 42, 54}, 
{ 5, 43,  0}, 
{ 5, 44,  1}, 
{6, 0, 0}, 
{6, 1, 0}, 
{6, 2, 0}, 
{6, 3, 0}, 
{6, 4, 0}, 
{6, 5, 0}, 
{6, 6, 0}, 
{6, 7, 0}, 
{6, 8, 0}, 
{6, 9, 0}, 
{ 6, 10,  0}, 
{ 6, 11,  0}, 
{ 6, 12,  0}, 
{ 6, 13,  0}, 
{ 6, 14,  0}, 
{ 6, 15,  0}, 
{ 6, 16,  0}, 
{ 6, 17,  0}, 
{ 6, 18,  0}, 
{ 6, 19,  0}, 
{ 6, 20,  0}, 
{ 6, 21,  0}, 
{ 6, 22,  0}, 
{ 6, 23,  0}, 
{ 6, 24,  0}, 
{ 6, 25,  0}, 
{ 6, 26,  0}, 
{ 6, 27,  0}, 
{ 6, 28,  0}, 
{ 6, 29,  0}, 
{ 6, 30,  0}, 
{ 6, 31,  0}, 
{ 6, 32,  0}, 
{ 6, 33,  0}, 
{ 6, 34,  0}, 
{ 6, 35,  0}, 
{ 6, 36,  0}, 
{ 6, 37,  2}, 
{ 6, 38,  0}, 
{ 6, 39, 75}, 
{  6,  40, 157}, 
{  6,  41, 127}, 
{ 6, 42, 22}, 
{ 6, 43,  0}, 
{ 6, 44,  1}, 
{7, 0, 0}, 
{7, 1, 0}, 
{7, 2, 0}, 
{7, 3, 0}, 
{7, 4, 0}, 
{7, 5, 0}, 
{7, 6, 0}, 
{7, 7, 0}, 
{7, 8, 0}, 
{7, 9, 0}, 
{ 7, 10,  0}, 
{ 7, 11,  0}, 
{ 7, 12,  0}, 
{ 7, 13,  0}, 
{ 7, 14,  0}, 
{ 7, 15,  0}, 
{ 7, 16,  0}, 
{ 7, 17,  0}, 
{ 7, 18,  0}, 
{ 7, 19,  0}, 
{ 7, 20,  0}, 
{ 7, 21,  0}, 
{ 7, 22,  0}, 
{ 7, 23,  0}, 
{ 7, 24,  0}, 
{ 7, 25,  0}, 
{ 7, 26,  0}, 
{ 7, 27,  0}, 
{ 7, 28,  0}, 
{ 7, 29,  0}, 
{ 7, 30,  0}, 
{ 7, 31,  0}, 
{ 7, 32,  0}, 
{ 7, 33,  0}, 
{ 7, 34,  0}, 
{ 7, 35,  0}, 
{ 7, 36,  0}, 
{ 7, 37,  0}, 
{ 7, 38,  5}, 
{  7,  39, 122}, 
{  7,  40, 158}, 
{ 7, 41, 99}, 
{ 7, 42,  3}, 
{ 7, 43,  0}, 
{ 7, 44,  0}, 
{8, 0, 0}, 
{8, 1, 0}, 
{8, 2, 0}, 
{8, 3, 0}, 
{8, 4, 0}, 
{8, 5, 0}, 
{8, 6, 0}, 
{8, 7, 0}, 
{8, 8, 0}, 
{8, 9, 0}, 
{ 8, 10,  0}, 
{ 8, 11,  0}, 
{ 8, 12,  0}, 
{ 8, 13,  0}, 
{ 8, 14,  0}, 
{ 8, 15,  0}, 
{ 8, 16,  0}, 
{ 8, 17,  0}, 
{ 8, 18,  0}, 
{ 8, 19,  0}, 
{ 8, 20,  0}, 
{ 8, 21,  0}, 
{ 8, 22,  0}, 
{ 8, 23,  0}, 
{ 8, 24,  0}, 
{ 8, 25,  0}, 
{ 8, 26,  0}, 
{ 8, 27,  0}, 
{ 8, 28,  0}, 
{ 8, 29,  0}, 
{ 8, 30,  0}, 
{ 8, 31,  0}, 
{ 8, 32,  0}, 
{ 8, 33,  0}, 
{ 8, 34,  0}, 
{ 8, 35,  0}, 
{ 8, 36,  2}, 
{ 8, 37,  0}, 
{ 8, 38, 43}, 
{  8,  39, 151}, 
{  8,  40, 148}, 
{ 8, 41, 68}, 
{ 8, 42,  0}, 
{ 8, 43,  1}, 
{ 8, 44,  0}, 
{9, 0, 0}, 
{9, 1, 0}, 
{9, 2, 0}, 
{9, 3, 0}, 
{9, 4, 0}, 
{9, 5, 0}, 
{9, 6, 0}, 
{9, 7, 0}, 
{9, 8, 0}, 
{9, 9, 0}, 
{ 9, 10,  0}, 
{ 9, 11,  0}, 
{ 9, 12,  0}, 
{ 9, 13,  0}, 
{ 9, 14,  0}, 
{ 9, 15,  0}, 
{ 9, 16,  0}, 
{ 9, 17,  0}, 
{ 9, 18,  0}, 
{ 9, 19,  0}, 
{ 9, 20,  0}, 
{ 9, 21,  0}, 
{ 9, 22,  0}, 
{ 9, 23,  0}, 
{ 9, 24,  0}, 
{ 9, 25,  0}, 
{ 9, 26,  0}, 
{ 9, 27,  0}, 
{ 9, 28,  0}, 
{ 9, 29,  0}, 
{ 9, 30,  0}, 
{ 9, 31,  0}, 
{ 9, 32,  0}, 
{ 9, 33,  0}, 
{ 9, 34,  0}, 
{ 9, 35,  1}, 
{ 9, 36,  1}, 
{ 9, 37,  0}, 
{  9,  38, 107}, 
{  9,  39, 156}, 
{  9,  40, 129}, 
{ 9, 41, 39}, 
{ 9, 42,  0}, 
{ 9, 43,  1}, 
{ 9, 44,  0}, 
{10,  0,  0}, 
{10,  1,  0}, 
{10,  2,  0}, 
{10,  3,  0}, 
{10,  4,  0}, 
{10,  5,  0}, 
{10,  6,  0}, 
{10,  7,  0}, 
{10,  8,  0}, 
{10,  9,  0}, 
{10, 10,  0}, 
{10, 11,  0}, 
{10, 12,  0}, 
{10, 13,  0}, 
{10, 14,  0}, 
{10, 15,  0}, 
{10, 16,  0}, 
{10, 17,  0}, 
{10, 18,  0}, 
{10, 19,  0}, 
{10, 20,  0}, 
{10, 21,  0}, 
{10, 22,  0}, 
{10, 23,  0}, 
{10, 24,  0}, 
{10, 25,  0}, 
{10, 26,  0}, 
{10, 27,  0}, 
{10, 28,  0}, 
{10, 29,  0}, 
{10, 30,  0}, 
{10, 31,  0}, 
{10, 32,  0}, 
{10, 33,  0}, 
{10, 34,  1}, 
{10, 35,  0}, 
{10, 36,  0}, 
{10, 37, 94}, 
{ 10,  38, 155}, 
{ 10,  39, 146}, 
{ 10,  40, 104}, 
{10, 41, 21}, 
{10, 42,  0}, 
{10, 43,  1}, 
{10, 44,  0}, 
{11,  0,  0}, 
{11,  1,  0}, 
{11,  2,  0}, 
{11,  3,  0}, 
{11,  4,  0}, 
{11,  5,  0}, 
{11,  6,  0}, 
{11,  7,  0}, 
{11,  8,  0}, 
{11,  9,  0}, 
{11, 10,  0}, 
{11, 11,  0}, 
{11, 12,  0}, 
{11, 13,  0}, 
{11, 14,  0}, 
{11, 15,  0}, 
{11, 16,  0}, 
{11, 17,  0}, 
{11, 18,  0}, 
{11, 19,  0}, 
{11, 20,  0}, 
{11, 21,  0}, 
{11, 22,  0}, 
{11, 23,  0}, 
{11, 24,  0}, 
{11, 25,  0}, 
{11, 26,  0}, 
{11, 27,  0}, 
{11, 28,  0}, 
{11, 29,  0}, 
{11, 30,  0}, 
{11, 31,  0}, 
{11, 32,  0}, 
{11, 33,  1}, 
{11, 34,  0}, 
{11, 35,  6}, 
{11, 36, 96}, 
{ 11,  37, 169}, 
{ 11,  38, 172}, 
{ 11,  39, 139}, 
{11, 40, 76}, 
{11, 41, 13}, 
{11, 42,  0}, 
{11, 43,  1}, 
{11, 44,  0}, 
{12,  0,  0}, 
{12,  1,  0}, 
{12,  2,  0}, 
{12,  3,  0}, 
{12,  4,  0}, 
{12,  5,  0}, 
{12,  6,  0}, 
{12,  7,  0}, 
{12,  8,  0}, 
{12,  9,  0}, 
{12, 10,  0}, 
{12, 11,  0}, 
{12, 12,  0}, 
{12, 13,  0}, 
{12, 14,  0}, 
{12, 15,  0}, 
{12, 16,  0}, 
{12, 17,  0}, 
{12, 18,  0}, 
{12, 19,  0}, 
{12, 20,  0}, 
{12, 21,  0}, 
{12, 22,  0}, 
{12, 23,  0}, 
{12, 24,  0}, 
{12, 25,  0}, 
{12, 26,  0}, 
{12, 27,  0}, 
{12, 28,  0}, 
{12, 29,  0}, 
{12, 30,  0}, 
{12, 31,  0}, 
{12, 32,  1}, 
{12, 33,  0}, 
{12, 34,  9}, 
{ 12,  35, 108}, 
{ 12,  36, 148}, 
{ 12,  37, 138}, 
{ 12,  38, 143}, 
{ 12,  39, 117}, 
{12, 40, 57}, 
{12, 41, 20}, 
{12, 42,  0}, 
{12, 43,  1}, 
{12, 44,  0}, 
{13,  0,  0}, 
{13,  1,  0}, 
{13,  2,  0}, 
{13,  3,  0}, 
{13,  4,  0}, 
{13,  5,  0}, 
{13,  6,  0}, 
{13,  7,  0}, 
{13,  8,  0}, 
{13,  9,  0}, 
{13, 10,  0}, 
{13, 11,  0}, 
{13, 12,  0}, 
{13, 13,  0}, 
{13, 14,  0}, 
{13, 15,  0}, 
{13, 16,  0}, 
{13, 17,  0}, 
{13, 18,  0}, 
{13, 19,  0}, 
{13, 20,  0}, 
{13, 21,  0}, 
{13, 22,  0}, 
{13, 23,  0}, 
{13, 24,  0}, 
{13, 25,  0}, 
{13, 26,  0}, 
{13, 27,  0}, 
{13, 28,  0}, 
{13, 29,  0}, 
{13, 30,  0}, 
{13, 31,  1}, 
{13, 32,  2}, 
{13, 33,  2}, 
{ 13,  34, 105}, 
{ 13,  35, 148}, 
{ 13,  36, 137}, 
{ 13,  37, 125}, 
{ 13,  38, 117}, 
{13, 39, 76}, 
{13, 40, 38}, 
{13, 41, 25}, 
{13, 42,  0}, 
{13, 43,  0}, 
{13, 44,  0}, 
{14,  0,  0}, 
{14,  1,  0}, 
{14,  2,  0}, 
{14,  3,  0}, 
{14,  4,  0}, 
{14,  5,  0}, 
{14,  6,  0}, 
{14,  7,  0}, 
{14,  8,  0}, 
{14,  9,  0}, 
{14, 10,  0}, 
{14, 11,  0}, 
{14, 12,  0}, 
{14, 13,  0}, 
{14, 14,  0}, 
{14, 15,  0}, 
{14, 16,  0}, 
{14, 17,  0}, 
{14, 18,  0}, 
{14, 19,  0}, 
{14, 20,  0}, 
{14, 21,  0}, 
{14, 22,  0}, 
{14, 23,  0}, 
{14, 24,  0}, 
{14, 25,  0}, 
{14, 26,  0}, 
{14, 27,  0}, 
{14, 28,  0}, 
{14, 29,  0}, 
{14, 30,  0}, 
{14, 31,  3}, 
{14, 32,  0}, 
{14, 33, 90}, 
{ 14,  34, 151}, 
{ 14,  35, 138}, 
{ 14,  36, 137}, 
{ 14,  37, 119}, 
{ 14,  38, 109}, 
{14, 39, 57}, 
{14, 40, 35}, 
{14, 41, 28}, 
{14, 42,  0}, 
{14, 43,  0}, 
{14, 44,  0}, 
{15,  0,  0}, 
{15,  1,  0}, 
{15,  2,  0}, 
{15,  3,  0}, 
{15,  4,  0}, 
{15,  5,  0}, 
{15,  6,  0}, 
{15,  7,  0}, 
{15,  8,  0}, 
{15,  9,  0}, 
{15, 10,  0}, 
{15, 11,  0}, 
{15, 12,  0}, 
{15, 13,  0}, 
{15, 14,  0}, 
{15, 15,  0}, 
{15, 16,  0}, 
{15, 17,  0}, 
{15, 18,  0}, 
{15, 19,  0}, 
{15, 20,  0}, 
{15, 21,  0}, 
{15, 22,  0}, 
{15, 23,  0}, 
{15, 24,  0}, 
{15, 25,  0}, 
{15, 26,  0}, 
{15, 27,  0}, 
{15, 28,  0}, 
{15, 29,  0}, 
{15, 30,  3}, 
{15, 31,  0}, 
{15, 32, 71}, 
{ 15,  33, 154}, 
{ 15,  34, 135}, 
{ 15,  35, 140}, 
{ 15,  36, 131}, 
{ 15,  37, 115}, 
{ 15,  38, 101}, 
{15, 39, 47}, 
{15, 40, 40}, 
{15, 41, 29}, 
{15, 42,  0}, 
{15, 43,  0}, 
{15, 44,  0}, 
{16,  0,  0}, 
{16,  1,  0}, 
{16,  2,  0}, 
{16,  3,  0}, 
{16,  4,  0}, 
{16,  5,  0}, 
{16,  6,  0}, 
{16,  7,  0}, 
{16,  8,  0}, 
{16,  9,  0}, 
{16, 10,  0}, 
{16, 11,  0}, 
{16, 12,  0}, 
{16, 13,  0}, 
{16, 14,  0}, 
{16, 15,  0}, 
{16, 16,  0}, 
{16, 17,  0}, 
{16, 18,  0}, 
{16, 19,  0}, 
{16, 20,  0}, 
{16, 21,  0}, 
{16, 22,  0}, 
{16, 23,  0}, 
{16, 24,  0}, 
{16, 25,  0}, 
{16, 26,  0}, 
{16, 27,  0}, 
{16, 28,  0}, 
{16, 29,  3}, 
{16, 30,  0}, 
{16, 31, 53}, 
{ 16,  32, 155}, 
{ 16,  33, 134}, 
{ 16,  34, 137}, 
{ 16,  35, 135}, 
{ 16,  36, 125}, 
{ 16,  37, 112}, 
{16, 38, 87}, 
{16, 39, 42}, 
{16, 40, 42}, 
{16, 41, 26}, 
{16, 42,  0}, 
{16, 43,  0}, 
{16, 44,  0}, 
{17,  0,  0}, 
{17,  1,  0}, 
{17,  2,  0}, 
{17,  3,  0}, 
{17,  4,  0}, 
{17,  5,  0}, 
{17,  6,  0}, 
{17,  7,  0}, 
{17,  8,  0}, 
{17,  9,  0}, 
{17, 10,  0}, 
{17, 11,  0}, 
{17, 12,  0}, 
{17, 13,  0}, 
{17, 14,  0}, 
{17, 15,  0}, 
{17, 16,  0}, 
{17, 17,  0}, 
{17, 18,  0}, 
{17, 19,  0}, 
{17, 20,  0}, 
{17, 21,  0}, 
{17, 22,  0}, 
{17, 23,  0}, 
{17, 24,  0}, 
{17, 25,  0}, 
{17, 26,  0}, 
{17, 27,  0}, 
{17, 28,  3}, 
{17, 29,  0}, 
{17, 30, 44}, 
{ 17,  31, 150}, 
{ 17,  32, 133}, 
{ 17,  33, 130}, 
{ 17,  34, 133}, 
{ 17,  35, 128}, 
{ 17,  36, 116}, 
{ 17,  37, 107}, 
{17, 38, 65}, 
{17, 39, 46}, 
{17, 40, 48}, 
{17, 41, 19}, 
{17, 42,  0}, 
{17, 43,  1}, 
{17, 44,  0}, 
{18,  0,  0}, 
{18,  1,  0}, 
{18,  2,  0}, 
{18,  3,  0}, 
{18,  4,  0}, 
{18,  5,  0}, 
{18,  6,  0}, 
{18,  7,  0}, 
{18,  8,  0}, 
{18,  9,  0}, 
{18, 10,  0}, 
{18, 11,  0}, 
{18, 12,  0}, 
{18, 13,  0}, 
{18, 14,  0}, 
{18, 15,  0}, 
{18, 16,  0}, 
{18, 17,  0}, 
{18, 18,  0}, 
{18, 19,  0}, 
{18, 20,  0}, 
{18, 21,  0}, 
{18, 22,  0}, 
{18, 23,  0}, 
{18, 24,  0}, 
{18, 25,  0}, 
{18, 26,  0}, 
{18, 27,  2}, 
{18, 28,  0}, 
{18, 29, 46}, 
{ 18,  30, 144}, 
{ 18,  31, 130}, 
{ 18,  32, 124}, 
{ 18,  33, 127}, 
{ 18,  34, 125}, 
{ 18,  35, 117}, 
{ 18,  36, 110}, 
{18, 37, 92}, 
{18, 38, 51}, 
{18, 39, 53}, 
{18, 40, 43}, 
{18, 41,  9}, 
{18, 42,  0}, 
{18, 43,  0}, 
{18, 44,  0}, 
{19,  0,  0}, 
{19,  1,  0}, 
{19,  2,  0}, 
{19,  3,  0}, 
{19,  4,  0}, 
{19,  5,  0}, 
{19,  6,  0}, 
{19,  7,  0}, 
{19,  8,  0}, 
{19,  9,  0}, 
{19, 10,  0}, 
{19, 11,  0}, 
{19, 12,  0}, 
{19, 13,  0}, 
{19, 14,  0}, 
{19, 15,  0}, 
{19, 16,  0}, 
{19, 17,  0}, 
{19, 18,  0}, 
{19, 19,  0}, 
{19, 20,  0}, 
{19, 21,  0}, 
{19, 22,  0}, 
{19, 23,  0}, 
{19, 24,  0}, 
{19, 25,  1}, 
{19, 26,  0}, 
{19, 27,  0}, 
{19, 28, 58}, 
{ 19,  29, 138}, 
{ 19,  30, 121}, 
{ 19,  31, 116}, 
{ 19,  32, 119}, 
{ 19,  33, 120}, 
{ 19,  34, 116}, 
{ 19,  35, 105}, 
{ 19,  36, 106}, 
{19, 37, 67}, 
{19, 38, 51}, 
{19, 39, 50}, 
{19, 40, 31}, 
{19, 41,  1}, 
{19, 42,  0}, 
{19, 43,  0}, 
{19, 44,  0}, 
{20,  0,  0}, 
{20,  1,  0}, 
{20,  2,  0}, 
{20,  3,  0}, 
{20,  4,  0}, 
{20,  5,  0}, 
{20,  6,  0}, 
{20,  7,  0}, 
{20,  8,  0}, 
{20,  9,  0}, 
{20, 10,  0}, 
{20, 11,  0}, 
{20, 12,  0}, 
{20, 13,  0}, 
{20, 14,  0}, 
{20, 15,  0}, 
{20, 16,  0}, 
{20, 17,  0}, 
{20, 18,  0}, 
{20, 19,  0}, 
{20, 20,  0}, 
{20, 21,  0}, 
{20, 22,  0}, 
{20, 23,  1}, 
{20, 24,  1}, 
{20, 25,  0}, 
{20, 26,  3}, 
{20, 27, 72}, 
{ 20,  28, 130}, 
{ 20,  29, 109}, 
{ 20,  30, 105}, 
{ 20,  31, 110}, 
{ 20,  32, 111}, 
{ 20,  33, 111}, 
{ 20,  34, 103}, 
{ 20,  35, 103}, 
{20, 36, 86}, 
{20, 37, 52}, 
{20, 38, 54}, 
{20, 39, 46}, 
{20, 40, 15}, 
{20, 41,  0}, 
{20, 42,  1}, 
{20, 43,  0}, 
{20, 44,  0}, 
{21,  0,  0}, 
{21,  1,  0}, 
{21,  2,  0}, 
{21,  3,  0}, 
{21,  4,  0}, 
{21,  5,  0}, 
{21,  6,  0}, 
{21,  7,  0}, 
{21,  8,  0}, 
{21,  9,  0}, 
{21, 10,  0}, 
{21, 11,  0}, 
{21, 12,  0}, 
{21, 13,  0}, 
{21, 14,  0}, 
{21, 15,  0}, 
{21, 16,  0}, 
{21, 17,  0}, 
{21, 18,  0}, 
{21, 19,  0}, 
{21, 20,  1}, 
{21, 21,  1}, 
{21, 22,  0}, 
{21, 23,  0}, 
{21, 24,  0}, 
{21, 25, 29}, 
{21, 26, 89}, 
{ 21,  27, 113}, 
{21, 28, 96}, 
{21, 29, 96}, 
{ 21,  30, 102}, 
{ 21,  31, 102}, 
{ 21,  32, 104}, 
{ 21,  33, 100}, 
{21, 34, 95}, 
{21, 35, 96}, 
{21, 36, 62}, 
{21, 37, 52}, 
{21, 38, 51}, 
{21, 39, 34}, 
{21, 40,  1}, 
{21, 41,  0}, 
{21, 42,  0}, 
{21, 43,  0}, 
{21, 44,  0}, 
{22,  0,  0}, 
{22,  1,  0}, 
{22,  2,  0}, 
{22,  3,  0}, 
{22,  4,  0}, 
{22,  5,  0}, 
{22,  6,  0}, 
{22,  7,  0}, 
{22,  8,  0}, 
{22,  9,  0}, 
{22, 10,  0}, 
{22, 11,  0}, 
{22, 12,  0}, 
{22, 13,  0}, 
{22, 14,  0}, 
{22, 15,  0}, 
{22, 16,  1}, 
{22, 17,  1}, 
{22, 18,  1}, 
{22, 19,  0}, 
{22, 20,  0}, 
{22, 21,  0}, 
{22, 22,  0}, 
{22, 23, 22}, 
{22, 24, 65}, 
{22, 25, 96}, 
{22, 26, 94}, 
{22, 27, 83}, 
{22, 28, 88}, 
{22, 29, 92}, 
{22, 30, 92}, 
{22, 31, 96}, 
{22, 32, 95}, 
{22, 33, 90}, 
{22, 34, 94}, 
{22, 35, 72}, 
{22, 36, 51}, 
{22, 37, 53}, 
{22, 38, 46}, 
{22, 39, 12}, 
{22, 40,  0}, 
{22, 41,  1}, 
{22, 42,  0}, 
{22, 43,  0}, 
{22, 44,  0}, 
{23,  0,  0}, 
{23,  1,  0}, 
{23,  2,  0}, 
{23,  3,  0}, 
{23,  4,  0}, 
{23,  5,  0}, 
{23,  6,  0}, 
{23,  7,  0}, 
{23,  8,  0}, 
{23,  9,  1}, 
{23, 10,  1}, 
{23, 11,  0}, 
{23, 12,  0}, 
{23, 13,  0}, 
{23, 14,  0}, 
{23, 15,  0}, 
{23, 16,  0}, 
{23, 17,  0}, 
{23, 18,  0}, 
{23, 19,  2}, 
{23, 20, 14}, 
{23, 21, 32}, 
{23, 22, 57}, 
{23, 23, 77}, 
{23, 24, 77}, 
{23, 25, 69}, 
{23, 26, 71}, 
{23, 27, 78}, 
{23, 28, 85}, 
{23, 29, 86}, 
{23, 30, 88}, 
{23, 31, 88}, 
{23, 32, 84}, 
{23, 33, 88}, 
{23, 34, 75}, 
{23, 35, 53}, 
{23, 36, 54}, 
{23, 37, 49}, 
{23, 38, 29}, 
{23, 39,  0}, 
{23, 40,  0}, 
{23, 41,  0}, 
{23, 42,  0}, 
{23, 43,  0}, 
{23, 44,  0}, 
{24,  0,  0}, 
{24,  1,  0}, 
{24,  2,  0}, 
{24,  3,  0}, 
{24,  4,  0}, 
{24,  5,  0}, 
{24,  6,  0}, 
{24,  7,  1}, 
{24,  8,  0}, 
{24,  9,  0}, 
{24, 10,  0}, 
{24, 11,  1}, 
{24, 12,  5}, 
{24, 13,  7}, 
{24, 14, 10}, 
{24, 15, 13}, 
{24, 16, 18}, 
{24, 17, 26}, 
{24, 18, 36}, 
{24, 19, 48}, 
{24, 20, 58}, 
{24, 21, 60}, 
{24, 22, 62}, 
{24, 23, 55}, 
{24, 24, 58}, 
{24, 25, 66}, 
{24, 26, 67}, 
{24, 27, 74}, 
{24, 28, 80}, 
{24, 29, 83}, 
{24, 30, 82}, 
{24, 31, 78}, 
{24, 32, 83}, 
{24, 33, 79}, 
{24, 34, 56}, 
{24, 35, 53}, 
{24, 36, 53}, 
{24, 37, 41}, 
{24, 38,  5}, 
{24, 39,  0}, 
{24, 40,  0}, 
{24, 41,  0}, 
{24, 42,  0}, 
{24, 43,  0}, 
{24, 44,  0}, 
{25,  0,  0}, 
{25,  1,  0}, 
{25,  2,  0}, 
{25,  3,  0}, 
{25,  4,  1}, 
{25,  5,  3}, 
{25,  6,  0}, 
{25,  7,  0}, 
{25,  8,  4}, 
{25,  9, 27}, 
{25, 10, 49}, 
{25, 11, 53}, 
{25, 12, 58}, 
{25, 13, 54}, 
{25, 14, 44}, 
{25, 15, 46}, 
{25, 16, 49}, 
{25, 17, 50}, 
{25, 18, 46}, 
{25, 19, 43}, 
{25, 20, 43}, 
{25, 21, 42}, 
{25, 22, 46}, 
{25, 23, 53}, 
{25, 24, 58}, 
{25, 25, 60}, 
{25, 26, 64}, 
{25, 27, 68}, 
{25, 28, 73}, 
{25, 29, 76}, 
{25, 30, 75}, 
{25, 31, 79}, 
{25, 32, 78}, 
{25, 33, 62}, 
{25, 34, 56}, 
{25, 35, 56}, 
{25, 36, 47}, 
{25, 37, 15}, 
{25, 38,  0}, 
{25, 39,  0}, 
{25, 40,  0}, 
{25, 41,  0}, 
{25, 42,  0}, 
{25, 43,  0}, 
{25, 44,  0}, 
{26,  0,  0}, 
{26,  1,  0}, 
{26,  2,  0}, 
{26,  3,  0}, 
{26,  4,  0}, 
{26,  5,  0}, 
{26,  6,  6}, 
{26,  7, 42}, 
{26,  8, 70}, 
{26,  9, 77}, 
{26, 10, 73}, 
{26, 11, 61}, 
{26, 12, 54}, 
{26, 13, 50}, 
{26, 14, 40}, 
{26, 15, 41}, 
{26, 16, 39}, 
{26, 17, 41}, 
{26, 18, 42}, 
{26, 19, 40}, 
{26, 20, 47}, 
{26, 21, 47}, 
{26, 22, 45}, 
{26, 23, 51}, 
{26, 24, 54}, 
{26, 25, 52}, 
{26, 26, 56}, 
{26, 27, 58}, 
{26, 28, 63}, 
{26, 29, 72}, 
{26, 30, 77}, 
{26, 31, 77}, 
{26, 32, 65}, 
{26, 33, 61}, 
{26, 34, 61}, 
{26, 35, 56}, 
{26, 36, 29}, 
{26, 37,  0}, 
{26, 38,  1}, 
{26, 39,  0}, 
{26, 40,  0}, 
{26, 41,  0}, 
{26, 42,  0}, 
{26, 43,  0}, 
{26, 44,  0}, 
{27,  0,  0}, 
{27,  1,  0}, 
{27,  2,  1}, 
{27,  3,  0}, 
{27,  4,  6}, 
{27,  5, 66}, 
{27,  6, 81}, 
{27,  7, 82}, 
{27,  8, 69}, 
{27,  9, 69}, 
{27, 10, 67}, 
{27, 11, 58}, 
{27, 12, 48}, 
{27, 13, 45}, 
{27, 14, 46}, 
{27, 15, 46}, 
{27, 16, 43}, 
{27, 17, 46}, 
{27, 18, 47}, 
{27, 19, 41}, 
{27, 20, 49}, 
{27, 21, 47}, 
{27, 22, 43}, 
{27, 23, 44}, 
{27, 24, 48}, 
{27, 25, 49}, 
{27, 26, 51}, 
{27, 27, 56}, 
{27, 28, 60}, 
{27, 29, 73}, 
{27, 30, 75}, 
{27, 31, 71}, 
{27, 32, 69}, 
{27, 33, 66}, 
{27, 34, 58}, 
{27, 35, 42}, 
{27, 36,  3}, 
{27, 37,  0}, 
{27, 38,  0}, 
{27, 39,  0}, 
{27, 40,  0}, 
{27, 41,  0}, 
{27, 42,  0}, 
{27, 43,  0}, 
{27, 44,  0}, 
{28,  0,  0}, 
{28,  1,  0}, 
{28,  2,  3}, 
{28,  3,  0}, 
{ 28,   4, 105}, 
{ 28,   5, 245}, 
{ 28,   6, 104}, 
{28,  7, 76}, 
{28,  8, 78}, 
{28,  9, 74}, 
{28, 10, 71}, 
{28, 11, 63}, 
{28, 12, 64}, 
{28, 13, 59}, 
{28, 14, 54}, 
{28, 15, 50}, 
{28, 16, 42}, 
{28, 17, 41}, 
{28, 18, 40}, 
{28, 19, 39}, 
{28, 20, 41}, 
{28, 21, 39}, 
{28, 22, 38}, 
{28, 23, 42}, 
{28, 24, 44}, 
{28, 25, 47}, 
{28, 26, 50}, 
{28, 27, 57}, 
{28, 28, 68}, 
{28, 29, 73}, 
{28, 30, 71}, 
{28, 31, 71}, 
{28, 32, 71}, 
{28, 33, 64}, 
{28, 34, 49}, 
{28, 35,  7}, 
{28, 36,  0}, 
{28, 37,  0}, 
{28, 38,  0}, 
{28, 39,  0}, 
{28, 40,  0}, 
{28, 41,  0}, 
{28, 42,  0}, 
{28, 43,  0}, 
{28, 44,  0}, 
{29,  0,  0}, 
{29,  1,  0}, 
{29,  2,  1}, 
{29,  3,  0}, 
{ 29,   4, 190}, 
{ 29,   5, 253}, 
{ 29,   6, 143}, 
{29,  7, 77}, 
{29,  8, 68}, 
{29,  9, 65}, 
{29, 10, 66}, 
{29, 11, 65}, 
{29, 12, 55}, 
{29, 13, 47}, 
{29, 14, 42}, 
{29, 15, 40}, 
{29, 16, 39}, 
{29, 17, 37}, 
{29, 18, 37}, 
{29, 19, 38}, 
{29, 20, 41}, 
{29, 21, 38}, 
{29, 22, 39}, 
{29, 23, 39}, 
{29, 24, 44}, 
{29, 25, 50}, 
{29, 26, 59}, 
{29, 27, 71}, 
{29, 28, 77}, 
{29, 29, 76}, 
{29, 30, 74}, 
{29, 31, 71}, 
{29, 32, 71}, 
{29, 33, 58}, 
{29, 34, 11}, 
{29, 35,  0}, 
{29, 36,  1}, 
{29, 37,  0}, 
{29, 38,  0}, 
{29, 39,  0}, 
{29, 40,  0}, 
{29, 41,  0}, 
{29, 42,  0}, 
{29, 43,  0}, 
{29, 44,  0}, 
{30,  0,  0}, 
{30,  1,  0}, 
{30,  2,  2}, 
{30,  3,  0}, 
{ 30,   4, 158}, 
{ 30,   5, 238}, 
{ 30,   6, 156}, 
{ 30,   7, 123}, 
{30,  8, 95}, 
{30,  9, 81}, 
{30, 10, 74}, 
{30, 11, 72}, 
{30, 12, 66}, 
{30, 13, 51}, 
{30, 14, 44}, 
{30, 15, 40}, 
{30, 16, 37}, 
{30, 17, 37}, 
{30, 18, 36}, 
{30, 19, 36}, 
{30, 20, 37}, 
{30, 21, 41}, 
{30, 22, 45}, 
{30, 23, 50}, 
{30, 24, 62}, 
{30, 25, 70}, 
{30, 26, 75}, 
{30, 27, 79}, 
{30, 28, 80}, 
{30, 29, 78}, 
{30, 30, 76}, 
{30, 31, 82}, 
{30, 32, 62}, 
{30, 33, 11}, 
{30, 34,  0}, 
{30, 35,  1}, 
{30, 36,  0}, 
{30, 37,  0}, 
{30, 38,  0}, 
{30, 39,  0}, 
{30, 40,  0}, 
{30, 41,  0}, 
{30, 42,  0}, 
{30, 43,  0}, 
{30, 44,  0}, 
{31,  0,  0}, 
{31,  1,  0}, 
{31,  2,  2}, 
{31,  3,  0}, 
{31,  4, 41}, 
{ 31,   5, 152}, 
{ 31,   6, 138}, 
{ 31,   7, 114}, 
{ 31,   8, 119}, 
{ 31,   9, 113}, 
{ 31,  10, 106}, 
{31, 11, 99}, 
{31, 12, 95}, 
{31, 13, 83}, 
{31, 14, 77}, 
{31, 15, 73}, 
{31, 16, 65}, 
{31, 17, 61}, 
{31, 18, 61}, 
{31, 19, 61}, 
{31, 20, 61}, 
{31, 21, 66}, 
{31, 22, 73}, 
{31, 23, 76}, 
{31, 24, 80}, 
{31, 25, 79}, 
{31, 26, 80}, 
{31, 27, 81}, 
{31, 28, 80}, 
{31, 29, 78}, 
{31, 30, 87}, 
{31, 31, 61}, 
{31, 32,  9}, 
{31, 33,  0}, 
{31, 34,  1}, 
{31, 35,  0}, 
{31, 36,  0}, 
{31, 37,  0}, 
{31, 38,  0}, 
{31, 39,  0}, 
{31, 40,  0}, 
{31, 41,  0}, 
{31, 42,  0}, 
{31, 43,  0}, 
{31, 44,  0}, 
{32,  0,  0}, 
{32,  1,  0}, 
{32,  2,  0}, 
{32,  3,  1}, 
{32,  4,  0}, 
{32,  5, 34}, 
{ 32,   6, 123}, 
{ 32,   7, 111}, 
{32,  8, 97}, 
{ 32,   9, 114}, 
{ 32,  10, 115}, 
{ 32,  11, 108}, 
{ 32,  12, 101}, 
{32, 13, 93}, 
{32, 14, 90}, 
{32, 15, 87}, 
{32, 16, 86}, 
{32, 17, 84}, 
{32, 18, 84}, 
{32, 19, 86}, 
{32, 20, 81}, 
{32, 21, 82}, 
{32, 22, 82}, 
{32, 23, 84}, 
{32, 24, 84}, 
{32, 25, 85}, 
{32, 26, 84}, 
{32, 27, 82}, 
{32, 28, 84}, 
{32, 29, 85}, 
{32, 30, 52}, 
{32, 31,  3}, 
{32, 32,  0}, 
{32, 33,  1}, 
{32, 34,  0}, 
{32, 35,  0}, 
{32, 36,  0}, 
{32, 37,  0}, 
{32, 38,  0}, 
{32, 39,  0}, 
{32, 40,  0}, 
{32, 41,  0}, 
{32, 42,  0}, 
{32, 43,  0}, 
{32, 44,  0}, 
{33,  0,  0}, 
{33,  1,  0}, 
{33,  2,  0}, 
{33,  3,  0}, 
{33,  4,  2}, 
{33,  5,  0}, 
{33,  6, 24}, 
{ 33,   7, 106}, 
{ 33,   8, 108}, 
{33,  9, 96}, 
{ 33,  10, 105}, 
{ 33,  11, 107}, 
{ 33,  12, 102}, 
{33, 13, 96}, 
{33, 14, 92}, 
{33, 15, 91}, 
{33, 16, 88}, 
{33, 17, 86}, 
{33, 18, 87}, 
{33, 19, 88}, 
{33, 20, 88}, 
{33, 21, 91}, 
{33, 22, 90}, 
{33, 23, 89}, 
{33, 24, 90}, 
{33, 25, 86}, 
{33, 26, 86}, 
{33, 27, 90}, 
{33, 28, 74}, 
{33, 29, 28}, 
{33, 30,  0}, 
{33, 31,  0}, 
{33, 32,  1}, 
{33, 33,  0}, 
{33, 34,  0}, 
{33, 35,  0}, 
{33, 36,  0}, 
{33, 37,  0}, 
{33, 38,  0}, 
{33, 39,  0}, 
{33, 40,  0}, 
{33, 41,  0}, 
{33, 42,  0}, 
{33, 43,  0}, 
{33, 44,  0}, 
{34,  0,  0}, 
{34,  1,  0}, 
{34,  2,  0}, 
{34,  3,  0}, 
{34,  4,  0}, 
{34,  5,  2}, 
{34,  6,  0}, 
{34,  7, 17}, 
{34,  8, 95}, 
{ 34,   9, 114}, 
{34, 10, 94}, 
{34, 11, 95}, 
{34, 12, 97}, 
{34, 13, 96}, 
{34, 14, 94}, 
{34, 15, 92}, 
{34, 16, 93}, 
{34, 17, 92}, 
{34, 18, 95}, 
{34, 19, 96}, 
{34, 20, 93}, 
{34, 21, 93}, 
{34, 22, 92}, 
{34, 23, 91}, 
{34, 24, 92}, 
{34, 25, 90}, 
{34, 26, 76}, 
{34, 27, 40}, 
{34, 28,  4}, 
{34, 29,  0}, 
{34, 30,  1}, 
{34, 31,  0}, 
{34, 32,  0}, 
{34, 33,  0}, 
{34, 34,  0}, 
{34, 35,  0}, 
{34, 36,  0}, 
{34, 37,  0}, 
{34, 38,  0}, 
{34, 39,  0}, 
{34, 40,  0}, 
{34, 41,  0}, 
{34, 42,  0}, 
{34, 43,  0}, 
{34, 44,  0}, 
{35,  0,  0}, 
{35,  1,  0}, 
{35,  2,  0}, 
{35,  3,  0}, 
{35,  4,  0}, 
{35,  5,  0}, 
{35,  6,  1}, 
{35,  7,  0}, 
{35,  8,  8}, 
{35,  9, 71}, 
{ 35,  10, 106}, 
{ 35,  11, 101}, 
{35, 12, 98}, 
{35, 13, 94}, 
{35, 14, 91}, 
{35, 15, 92}, 
{35, 16, 92}, 
{35, 17, 92}, 
{35, 18, 93}, 
{35, 19, 96}, 
{35, 20, 95}, 
{35, 21, 95}, 
{35, 22, 94}, 
{35, 23, 87}, 
{35, 24, 68}, 
{35, 25, 36}, 
{35, 26,  6}, 
{35, 27,  0}, 
{35, 28,  0}, 
{35, 29,  1}, 
{35, 30,  0}, 
{35, 31,  0}, 
{35, 32,  0}, 
{35, 33,  0}, 
{35, 34,  0}, 
{35, 35,  0}, 
{35, 36,  0}, 
{35, 37,  0}, 
{35, 38,  0}, 
{35, 39,  0}, 
{35, 40,  0}, 
{35, 41,  0}, 
{35, 42,  0}, 
{35, 43,  0}, 
{35, 44,  0}, 
{36,  0,  0}, 
{36,  1,  0}, 
{36,  2,  0}, 
{36,  3,  0}, 
{36,  4,  0}, 
{36,  5,  0}, 
{36,  6,  0}, 
{36,  7,  1}, 
{36,  8,  0}, 
{36,  9,  0}, 
{36, 10, 24}, 
{36, 11, 59}, 
{36, 12, 76}, 
{36, 13, 81}, 
{36, 14, 80}, 
{36, 15, 82}, 
{36, 16, 79}, 
{36, 17, 79}, 
{36, 18, 79}, 
{36, 19, 69}, 
{36, 20, 61}, 
{36, 21, 51}, 
{36, 22, 35}, 
{36, 23, 16}, 
{36, 24,  0}, 
{36, 25,  0}, 
{36, 26,  0}, 
{36, 27,  1}, 
{36, 28,  0}, 
{36, 29,  0}, 
{36, 30,  0}, 
{36, 31,  0}, 
{36, 32,  0}, 
{36, 33,  0}, 
{36, 34,  0}, 
{36, 35,  0}, 
{36, 36,  0}, 
{36, 37,  0}, 
{36, 38,  0}, 
{36, 39,  0}, 
{36, 40,  0}, 
{36, 41,  0}, 
{36, 42,  0}, 
{36, 43,  0}, 
{36, 44,  0}, 
{37,  0,  0}, 
{37,  1,  0}, 
{37,  2,  0}, 
{37,  3,  0}, 
{37,  4,  0}, 
{37,  5,  0}, 
{37,  6,  0}, 
{37,  7,  0}, 
{37,  8,  1}, 
{37,  9,  1}, 
{37, 10,  0}, 
{37, 11,  0}, 
{37, 12,  0}, 
{37, 13,  4}, 
{37, 14,  7}, 
{37, 15,  9}, 
{37, 16, 10}, 
{37, 17,  9}, 
{37, 18,  7}, 
{37, 19,  2}, 
{37, 20,  0}, 
{37, 21,  0}, 
{37, 22,  0}, 
{37, 23,  0}, 
{37, 24,  0}, 
{37, 25,  1}, 
{37, 26,  0}, 
{37, 27,  0}, 
{37, 28,  0}, 
{37, 29,  0}, 
{37, 30,  0}, 
{37, 31,  0}, 
{37, 32,  0}, 
{37, 33,  0}, 
{37, 34,  0}, 
{37, 35,  0}, 
{37, 36,  0}, 
{37, 37,  0}, 
{37, 38,  0}, 
{37, 39,  0}, 
{37, 40,  0}, 
{37, 41,  0}, 
{37, 42,  0}, 
{37, 43,  0}, 
{37, 44,  0}};



//state variables for the process
volatile uint8_t keep_moving = 0;    //a state to determine if there are steps remaining to move
volatile uint8_t x_enable = 0;
volatile uint8_t y_enable = 0;
volatile uint8_t z_enable = 0;
volatile int image_carved = 0;   //a state variable to determine if the image is carved yet or not
volatile int data_loaded = 0;    //a state variable to determine if the image is loaded or not
volatile int aligned = 0;        // a state variable to determine if the device is aligned or not
volatile int material_loaded = 0;// a state that determines if material has been loaded into the device

void create_dummy_image() {
//    int i, j, z;
//    for (i = 0; i < X_DIM; i++) {
//        for (j = 0; j < Y_DIM; j++) {
//            if (i == 0) image[i][j] = 3;
//            if (i == 1) image[i][j] = 2;
//            if (i == 2) image[i][j] = 1;
//            if (i == 3) image[i][j] = 0;
//            
//        }
//    }


    //clear_GreenLED();
    data_loaded = 1;
}
void load_start_cond(void)
{
  data_loaded     = 0;        
  image_carved    = 0;       
  keep_moving     = 0;
  aligned         = 0;
  material_loaded = 0;
}

volatile int debug = 0;

/************************* [ ISRs ] *******************************************/
// == Timer 2 ISR =====================================================
// steps the x and y motors IF there are steps remaining
void __ISR(_TIMER_2_VECTOR, ipl2) Timer2Handler(void)
{
  // Move Z first
  if (z_enable && stp_3.stps_left > 0) {
    toggle_stp(&stp_3);
    stp_3.stps_left--;
    if (stp_3.dir_move == 1) {
        stp_3.pos++;
        if (stp_3.pos == Z_LIMIT) disable_stp(&stp_3);
    } else {
        stp_3.pos--;
        if (stp_3.pos == 0) disable_stp(&stp_3);
    }
    if (stp_3.stps_left == 0) disable_stp(&stp_3);
  } else if (x_enable && stp_1.stps_left > 0) {
    toggle_stp(&stp_1);
    stp_1.stps_left--;
    if (stp_1.dir_move == 1) stp_1.pos++;
    else stp_1.pos--;
    if (stp_1.stps_left == 0) disable_stp(&stp_1);
  } else if (y_enable && stp_2.stps_left > 0) {
    toggle_stp(&stp_2);
    stp_2.stps_left--;
    if (stp_2.dir_move == 1) stp_2.pos++;
    else stp_2.pos--;
    if (stp_2.stps_left == 0) disable_stp(&stp_2);
  }

  // Checking if all motors are done stepping, and if so then updating the state
  if (stp_1.stps_left <= 0 && stp_2.stps_left <= 0 && stp_3.stps_left <= 0) 
    keep_moving = 0;

  // Clearing the interrupt flag
  mT2ClearIntFlag();
}

// === Move Thread =================================================
// Finds next location to travel to & calculates the steps needed to get there
// Sets steps for each axis and yiel3ds until the motion is complete
// DC motor is turned on, or remains on, if the location is to be removed
static int move_start = 0;
static int debug10, debug11;
static int debug12, debug13, debug14, debug15;
static int debug16, debug17, debug18;
static int debug19, debug20;
static int debug21, debug22, debug23;
static int debug24, debug25, debug26;
//currently each change in x and y is 585 steps, z axis is a change of 2000
static PT_THREAD (protothread_move(struct pt *pt))
{
  PT_BEGIN(pt);
  while(1) {
  // Wait until the board aligned, material loaded, & the data loaded
  PT_YIELD_UNTIL(&pt_move, data_loaded == 1);
  PT_YIELD_UNTIL(&pt_move, material_loaded == 1); 
  move_start = 1;
  //set_RedLED();
  //PT_YIELD_TIME_msec(500);
  //clear_RedLED();
  //clear_GreenLED();
 
  static int x_pos = 0; static int y_pos = 0; static int z_pos = 0;
  static int i;
  static int j;
  static image_t last_pixel;
  static image_t pixel;
  static int raise_x = 0; static int raise_y = 0 ;
  uint8_t z_start = 255;
  debug19 = z_start; debug20 = image_size;
//  // Move Z to start position
//  move(&stp_3, Z_START);
//  keep_moving = 1;
//  PT_YIELD_UNTIL(&pt_move, keep_moving == 0);
//  disable_stp(&stp_3);

  // Find highest position in image and start there
  for (i = 60; i < z_start+1; i=i+15) {
      debug10 = i; debug19 = z_start;
 //     PT_YIELD_TIME_msec(2000);
    for (j = 0; j < image_size; j++) {
        debug11 = j; debug20 = image_size;
        
  //       PT_YIELD_TIME_msec(2000);
      // Check if z position should be cut
      pixel = image[j];
      debug12 = pixel.x; debug13 = pixel.y; debug14 = pixel.z;

      
      if (i == 0 && j == 0) last_pixel = pixel;
       if (pixel.z <= i) { 
          if (absDiff(image[j-1].y, pixel.y)> 1) raise_y = 1;
          if (absDiff(last_pixel.x, pixel.x)> 1) raise_x = 1;
          continue; 
      }
      if (absDiff(last_pixel.x, pixel.x) >= 1 || absDiff(last_pixel.y, pixel.y) > 1) {
          debug15++;
        set_dc_state(&dc, 0);
        z_pos = Z_START;
        move(&stp_3, z_pos);
        keep_moving = 1;
        PT_YIELD_UNTIL(&pt_move, keep_moving == 0);
        disable_stp(&stp_3);
      }
      // Travel to (x, y) coordinate to drill
      debug24 = last_pixel.x; debug25 = pixel.x;
      
      if (j != 0 && absDiff(last_pixel.x, pixel.x)> 1 || raise_x == 1) {
          debug26++;
        set_dc_state(&dc, 0);
        set_dir(&stp_1, 0);
        enable_stp(&stp_1);
        PT_YIELD_TIME_msec(SLEEP_TIME);
        while(read_limit_x() == 0) {
         // stp_1.stps_left = 0;
          stp_1.stps_left = 50;
         // stp_3.stps_left = 0;
          //keep_moving = 1;
          // Halting until the desired position is reached
         // PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
        }
        stp_1.stps_left = 0;
        stp_1.pos = 0;       
        raise_x = 0;
      }
      x_pos = pixel.x*STEP_X + X_START; debug1 = pixel.x;
      move(&stp_1, x_pos);
      keep_moving = 1;
      PT_YIELD_UNTIL(&pt_move, keep_moving == 0);
      disable_stp(&stp_1);
      
      debug21 = image[j-1].y; debug22 = pixel.y;
      debug23 = (j != 0 && absDiff(image[j-1].y, pixel.y) > 1);
      
      if (j != 0 && absDiff(image[j-1].y, pixel.y)> 1 || raise_y == 1) {
        set_dc_state(&dc, 0);
        set_dir(&stp_2, 0);
        enable_stp(&stp_2);
        PT_YIELD_TIME_msec(SLEEP_TIME);
        while(read_limit_y() == 0) {
         // stp_1.stps_left = 0;
          stp_2.stps_left = 50;
         // stp_3.stps_left = 0;
          //keep_moving = 1;
          // Halting until the desired position is reached
         // PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
        }
        stp_2.stps_left = 0;
        stp_2.pos = 0;       
        raise_y = 0;
      }
      y_pos = pixel.y*STEP_Y + Y_START; debug2 = pixel.y;
      move(&stp_2, y_pos);
      keep_moving = 1;
      PT_YIELD_UNTIL(&pt_move, keep_moving == 0);
      disable_stp(&stp_2);
      
      set_dc_state(&dc, 1); debug4 = 1;
      z_pos = Z_START-i*STEP_Z;
      debug14 = z_pos;
      move(&stp_3, z_pos);
      keep_moving = 1;
      PT_YIELD_UNTIL(&pt_move, keep_moving == 0);
      disable_stp(&stp_3);
      
      last_pixel = pixel;
      debug16 = last_pixel.x; debug17 = last_pixel.y; debug18 = last_pixel.z;
    }
  }
  
  set_dc_state(&dc, 0);
  // Once done working through the image array just yield forever
  PT_YIELD_UNTIL(&pt_move, image_carved == 0); 
  load_start_cond();
  //while(1) PT_YIELD(&pt_move);
  }
  PT_END(pt);
}

/**
 * This thread runs after serial thread & ends operation when limit switches hit
 * @param pt
 * @return 
 */
static PT_THREAD (protothread_align(struct pt *pt))
{
  PT_BEGIN(pt);
  static int start = 0;
  while(1) {
    // Wait for the initial data from serial thread before aligning
    PT_YIELD_UNTIL(&pt_align, data_loaded == 1);
    // Align on the y axis first
  // set_tftLED();
    while(read_limit_y() == 0) {
      set_dir(&stp_2, 0);
      enable_stp(&stp_2);
      PT_YIELD_TIME_msec(SLEEP_TIME);
      stp_1.stps_left = 0;
      stp_2.stps_left = 50;
      stp_3.stps_left = 0;
      keep_moving = 1;
      // Halting until the desired position is reached
      PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
    }
    disable_stp(&stp_2);
    stp_2.pos = 0;

      
    // Align on z axis
    while(read_limit_z() == 0){
      set_dir(&stp_3, 0);
      enable_stp(&stp_3);
      PT_YIELD_TIME_msec(SLEEP_TIME);
      stp_1.stps_left = 0;
      stp_2.stps_left = 0;
      stp_3.stps_left = 50;
      keep_moving = 1;
      //Halting until the desired position is reached
      PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
    }
    disable_stp(&stp_3);
    stp_3.pos = 0;
   
    // Align on the x axis last
    while(read_limit_x() == 0) {
      set_dir(&stp_1, 0);
      enable_stp(&stp_1);
      PT_YIELD_TIME_msec(SLEEP_TIME);
      stp_1.stps_left = 50;
      stp_2.stps_left = 0;
      stp_3.stps_left = 0;
      keep_moving = 1;
      // Halting until the desired position is reached
      PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
    }
    disable_stp(&stp_1);
    stp_1.pos = 0;

    // All alignments done, Wait for user to confirm material is loaded
    // Then use other threads until complete
    aligned = 1;
    while(read_mat_load() == 0); //do nothing but wait
    // Realigning after material loaded only at the start of execution
    if (start == 0){  
      // Raising z to be completely clear
      set_dir(&stp_3, 1);
      enable_stp(&stp_3);
      PT_YIELD_TIME_msec(SLEEP_TIME);
      stp_1.stps_left = 0;
      stp_2.stps_left = 0;
      stp_3.stps_left = Z_START;
      keep_moving = 1;  
      //halting until the desired position is reached
      PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
      disable_stp(&stp_3);
      // Raising y to be completely clear
      set_dir(&stp_2, 1);
      enable_stp(&stp_2);
      PT_YIELD_TIME_msec(SLEEP_TIME);
      stp_1.stps_left = 0;
      stp_2.stps_left = Y_START;
      stp_3.stps_left = 0;
      keep_moving = 1;
      // Halting until the desired position is reached
      PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
      disable_stp(&stp_2);
      // Raising x to be completely clear
      set_dir(&stp_1, 1);
      enable_stp(&stp_1);
      PT_YIELD_TIME_msec(SLEEP_TIME);
      stp_1.stps_left = X_START;
      stp_2.stps_left = 0;
      stp_3.stps_left = 0;
      keep_moving = 1;
      // Halting until the desired position is reached
      PT_YIELD_UNTIL(&pt_align, keep_moving == 0);
      disable_stp(&stp_1);
      start = 1;
    }
    // After finishing the alignment yield until alignment is needed again
    material_loaded = 1;
    PT_YIELD_UNTIL(&pt_align, aligned == 0);
  }  
  PT_END(pt);
} // alignment thread



//=== Serial thread =================================================
static PT_THREAD (protothread_serial(struct pt *pt))
{
  PT_BEGIN(pt);
  static char cmd[1];
  static uint8_t x_val, y_val, z_val;
  static int count = 0;
  while(1) { 
     // set_GreenLED();
    // Send the prompt via DMA to serial
    sprintf(PT_send_buffer,"cmd>");
    // Spawning a print thread
    PT_SPAWN(pt, &pt_DMA_output, PT_DMA_PutSerialBuffer(&pt_DMA_output) );
    //spawn a thread to handle terminal input
    // the input thread waits for input
    // -- BUT does NOT block other threads
    // string is returned in "PT_term_buffer"
    PT_SPAWN(pt, &pt_input, PT_GetSerialBuffer(&pt_input) );
    // returns when the thread dies
    // in this case, when <enter> is pushed
    // now parse the string
    sscanf(PT_term_buffer, "%s %c %c %c", cmd, &x_val, &y_val, &z_val);

    switch(cmd[0]) {
    case 's':
      image_size = z_val;  
    case 'p': // Load pixel values into the pixel array
      image[count].x = x_val;
      image[count].y = y_val;
      image[count].z = z_val;
      count++;
      //toggle_RedLED();
      break;
    case 'e': // All data loaded, Terminate signal sent
      //if (count == image_size) clear_GreenLED();
      data_loaded = 1;
      PT_YIELD_UNTIL(&pt_serial, data_loaded == 0);
      break;
    default: // Do nothing                  
      break;
    }
    // never exit while
  } // END WHILE(1) 
  PT_END(pt);
} // serial thread


static PT_THREAD (protothread_tft(struct pt *pt))
{
    PT_BEGIN(pt);
     tft_setCursor(0, 0);
     tft_setTextColor(ILI9340_WHITE);  tft_setTextSize(1);
     tft_writeString("Time in seconds since boot\n");
      while(1) {
        // yield time 1 second
        PT_YIELD_TIME_msec(1000) ;
        // draw sys_time
        tft_fillRoundRect(0, 50, 320, 200, 1, ILI9340_BLACK);// x,y,w,h,radius,color
        tft_setCursor(0, 10);
        tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
        tft_writeString(buffer);

        if (debug3) {
            tft_setCursor(60, 30);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"toggle");
            tft_writeString(buffer);
        }
        if (aligned) {
            tft_setCursor(0, 30);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"aligned");
            tft_writeString(buffer);
        }
//        if (debug3) {
//            tft_setCursor(60, 70);
//            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
//            sprintf(buffer,"y %d z %d x %d", debug100, debug101, debug102);
//            tft_writeString(buffer);
//        }
        if (debug3 != 1) {
            tft_setCursor(0, 70);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"x %u y %u z %u d %c", debug1, debug2, debug3, debug4);
            tft_writeString(buffer);
        }
        if (aligned) {
            tft_setCursor(0, 50);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"moved res %d zst %d isz %d", debug15, debug19, debug20);
            tft_writeString(buffer);
            tft_setCursor(0, 90);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"i %d j %d", debug10, debug11);
            tft_writeString(buffer);
            tft_setCursor(0, 110);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"x: pos %d, s %d, d %d", stp_1.pos, stp_1.stps_left, stp_1.dir_move);
            tft_writeString(buffer);
            tft_setCursor(0, 130);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"y: pos %d, s %d, d %d", stp_2.pos, stp_2.stps_left, stp_2.dir_move);
            tft_writeString(buffer);
            tft_setCursor(0, 150);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"z: pos %d, s %d, d %d", stp_3.pos, stp_3.stps_left, stp_3.dir_move);
            tft_writeString(buffer);
            tft_setCursor(0, 170);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"pix x %d y %d z %d", debug12, debug13, debug14);
            tft_writeString(buffer);
            tft_setCursor(0,190);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"last x %d y %d z %d", debug16, debug17, debug18);
            tft_writeString(buffer);
            tft_setCursor(0,210);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"y-1 %d y %d res %d", debug21, debug22, debug23);
            tft_writeString(buffer);
             tft_setCursor(0,230);
            tft_setTextColor(ILI9340_YELLOW); tft_setTextSize(2);
            sprintf(buffer,"x-1 %d x %d res %d", debug24, debug25, debug26);
            tft_writeString(buffer);
        }
        // NEVER exit while
      } // END WHILE(1)
  PT_END(pt);
} // timer thread

/************************** [ Main ] ******************************************/

void main(void) { 
  // === Config timer and output compares to make pulses ========
  // Setup timer2 - X & Y axis
  OpenTimer2(T2_ON | T2_SOURCE_INT | T2_PS_1_1, XY_PERIOD);
  ConfigIntTimer2(T2_INT_ON | T2_INT_PRIOR_2);
  mT2ClearIntFlag(); // and clear the interrupt flag
    
  // === config threads ==========
  // turns OFF UART support and debugger pin, unless defines are set
  PT_setup();
  // === setup system wide interrupts  ========
  INTEnableSystemMultiVectoredInt();
  // init the threads
 // PT_INIT(&pt_serial);
  PT_INIT(&pt_move);
  PT_INIT(&pt_align);
  PT_INIT(&pt_tft);
 
  // Init everything else
   // init the display
  tft_init_hw();
  tft_begin();
  tft_fillScreen(ILI9340_BLACK);
  //240x320 vertical display
  tft_setRotation(1); // Use tft_setRotation(1) for 320x240
  //init_RedLED(); init_GreenLED();
 // init_tftLED();
  init_limit_switches();
  init_steppers(&stp_1, &stp_2, &stp_3);
  init_dc_motor(&dc);
  load_start_cond();
  create_dummy_image();  
  // Schedule the threads
  while (1){
   //   PT_SCHEDULE(protothread_serial(&pt_serial));
      PT_SCHEDULE(protothread_move(&pt_move)); 
      PT_SCHEDULE(protothread_align(&pt_align)); 
      PT_SCHEDULE(protothread_tft(&pt_tft));
  }
} // main